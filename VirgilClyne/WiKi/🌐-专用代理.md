## ç®€ä»‹
  * ä¿æŒæ¨¡å—/è§„åˆ™å¯ç”¨,å³å¯è®©æ­¤ç½‘å…³ä¸‹å±ç»ˆç«¯è®¾å¤‡æ­£å¸¸ç›´è¿ä½¿ç”¨ã€ŒiCloud ä¸“ç”¨ä»£ç†ã€ã€‚
  
  * æ³¨:
    * ğŸ†•iOS 15.2èµ·ï¼ŒWi-Fiè®¾ç½®ä¸­çš„`iCloudä¸“ç”¨ä»£ç†`é€‰é¡¹å˜æ›´ä¸º`é™åˆ¶IPåœ°å€è¿½è¸ª`,å¯ç”¨å¹¶ç”Ÿæ•ˆåä¸å†æœ‰Wi-Fiè®¾ç½®ä¸­çš„DNSè¿›è¡ŒåŸŸåè§£æï¼ŒçŒœæµ‹ç”±ä¸‹åˆ—DOHè§£æ
    * iCloud ä¸“ç”¨ä»£ç†æœ¬è´¨ä¸ºTUNæ¨¡å¼é€æ˜ä»£ç†ï¼Œæ‰€ä»¥ä¸æœ¬æœºTUNæ¨¡å¼VPNå†²çªï¼Œè§£å†³æ–¹æ³•å¾…éªŒè¯ã€‚
    * å¯ç”¨æ¨¡å—/è§„åˆ™çš„è®¾å¤‡è‡ªèº«æ— æ³•è§£é”/ä½¿ç”¨ã€ŒiCloud ä¸“ç”¨ä»£ç†ã€ï¼ˆå¾…éªŒè¯ï¼‰ã€‚
    * ä»…åœ¨`Surge for Mac`çš„`ç½‘å…³æ¨¡å¼`ä¸‹é€šè¿‡æµ‹è¯•ï¼Œæœªåœ¨`Surge for iOS`çš„`Wi-Fiè®¿é—®`æµ‹è¯•è¿‡ã€‚
    * ã€Œå¯ç”¨æ€§éªŒè¯ã€ç¯èŠ‚ä¾æ—§éœ€è¦èµ°ä»£ç†ï¼ˆåŸŸååˆ—è¡¨å¾…ä¼˜åŒ–ï¼‰ï¼Œã€Œä¸“ç”¨ä»£ç†ã€è‡ªèº«æµé‡ä¸ºç›´é“¾è®¿é—®ï¼Œè½åœ°æœåŠ¡å™¨å–å†³äºã€Œå¯ç”¨æ€§éªŒè¯ã€ç¯èŠ‚æŒ‡å‘çš„ä»£ç†æœåŠ¡å™¨ã€‚
    * ä¸€æ—¦ã€Œä¸“ç”¨ä»£ç†ã€å¯ç”¨å·¥ä½œï¼Œé™¤iCloudä¸“ç”¨ä»£ç†ç›¸å…³æ£€æµ‹åŸŸåå¤–ï¼Œå…¶ä½™`é‚®ä»¶`å’Œ`Safariæµè§ˆå™¨`æµé‡å°†ä¸å†æš´éœ²äºã€Œä¸“ç”¨ä»£ç†ã€ä¹‹å¤–ã€‚
    * ã€Œä¸“ç”¨ä»£ç†ã€è®¿é—®é‡‡ç”¨QUIC(UDP,443)æŠ€æœ¯ï¼Œç›¸å…³æœåŠ¡å™¨ç”±Akamaiã€Fastly å’ŒCloudflareæä¾›ï¼Œè¯·ä¿è¯è‡ªèº«ç›´è¿è®¿é—®è¿™äº›æœåŠ¡è‰¯å¥½ï¼Œå±…ä½åœ°åŠè¿è¥å•†ç½‘ç»œè´¨é‡å ªå¿§è¯·è‡ªå·±æƒ³åŠæ³•è§£å†³ã€‚
    * ç›¸å…³ä»‹ç»è¯·è§:https://developer.apple.com/cn/support/prepare-your-network-for-icloud-private-relay/
    * å‡ºå£IPåˆ—è¡¨:https://mask-api.icloud.com/egress-ip-ranges.csv

## ä½¿ç”¨è¯´æ˜
  * å› ä¸ºç›®å‰æ²¡æœ‰ç¨³å®šè§¦å‘`ä¸“ç”¨ä»£ç†`å½“å‰åœ°åŒºå¯ç”¨æ€§æ£€æµ‹çš„æ–¹æ³•ï¼Œæ‰€ä»¥å»ºè®®é‡æ–°å¼€æœºæ¥æ‰‹åŠ¨è§¦å‘æ£€æµ‹
  * æœªè£…æœ‰SIMå¡æˆ–è®¾ç½®äº†SIMå¡PINçš„iOS/iPadOS/macOSè®¾å¤‡ï¼Œå¯çœç•¥`âœˆï¸é£è¡Œæ¨¡å¼`ç›¸å…³æ­¥éª¤
  1. åœ¨å……å½“ç½‘å…³çš„`Surge for macOS`ä¸Šå¯ç”¨`Apple_iCloud_Private_Relay.getaway.sgmodule`æ¨¡å—
  2. åœ¨`Surge for macOS`ä¸­æŒ‡å®šç›¸å…³ä»£ç†çº¿è·¯ä¸ºğŸ‡ºğŸ‡¸ç¾å›½æˆ–å…¶ä»–å¯ç”¨åœ°åŒº,æˆ–è€…`å…¨å±€æ¨¡å¼`
  3. æ‰“å¼€ç»ˆç«¯è®¾å¤‡çš„`âœˆï¸é£è¡Œæ¨¡å¼`å`å…³æœº`
  4. é‡æ–°å°†ç»ˆç«¯è®¾å¤‡`å¼€æœº`,è§£é”å±å¹•ä½†ä¸å…³é—­`âœˆï¸é£è¡Œæ¨¡å¼`æˆ–ä¸è¾“å…¥SIMå¡PINï¼Œç­‰å¾…è®¾å¤‡è¿æ¥`Wi-Fi`æˆ–`æœ‰çº¿ç½‘ç»œ`é€šè¿‡`ä¸“ç”¨ä»£ç†å¯ç”¨æ€§`éªŒè¯
  5. æ­¤æ—¶åº”åœ¨`Surge for macOS`çš„`è¯·æ±‚æŸ¥çœ‹å™¨`ä¸­è§‚å¯Ÿåˆ°:
     1. æ£€æµ‹iCloudä¸­æ˜¯å¦åŒ…å«`ä¸“ç”¨ä»£ç†è®¢é˜…(networking.privacy.subscriber)`çš„é“¾æ¥`p*-acsegateway.icloud.com`ï¼Œä¸”è¯·æ±‚å¤´`X-MMe-Country`æ˜¯`TW`
     2. åŒ…å«å¯ç”¨æ€§æ£€æµ‹çš„`è·å–ä¸“ç”¨ä»£ç†éªŒè¯ä»¤ç‰Œ`é“¾æ¥ï¼š`https://mask-api.icloud.com/v*/fetchAuthTokens`
     3. åŒ…å«ä»£ç†æœåŠ¡å™¨åˆ†é…çš„`è·å–ä¸“ç”¨ä»£ç†é…ç½®æ–‡ä»¶`é“¾æ¥ï¼š`https://mask-api.icloud.com/v*_*/fetchConfigFile`(éå¿…éœ€ã€é¦–æ¬¡å¯ç”¨`ä¸“ç”¨ä»£ç†`æˆ–å‘¨æœŸæ€§æ›´æ–°)
  6. å…³é—­ç»ˆç«¯è®¾å¤‡`âœˆï¸é£è¡Œæ¨¡å¼`æˆ–è¾“å…¥SIMå¡PIN
  7. æ‰“å¼€ç»ˆç«¯è®¾å¤‡`è®¾ç½®`-`Apple ID`-`iCloud`-`ä¸“ç”¨ä»£ç†ï¼ˆBetaç‰ˆï¼‰`ï¼Œæ­¤æ—¶åº”æ˜¯[è§£é”çŠ¶æ€è¯´æ˜](#è§£é”çŠ¶æ€è¯´æ˜-1)ä¸­çš„`è§£é”æˆåŠŸ`çŠ¶æ€
  8. æ­£å¸¸ä½¿ç”¨

## è§£é”çŠ¶æ€è¯´æ˜
|  ä¸æ”¯æŒ  |  å¯ç”¨  |  æš‚ä¸å¯ç”¨  |  æµé‡å®¡æ ¸  |  å…³é—­  |
| :---: | :---: | :---: | :---: | :---: |
| æœªé€šè¿‡åœ°åŒºæ£€æµ‹ | å·²æˆåŠŸé€šè¿‡åœ°åŒºæ£€æµ‹ | ä¸iCloudçš„QUICè¿æ¥è¢«é˜»æ­¢ | ä¸iCloudä¸“ç”¨ä»£ç†çš„è¿æ¥è¢«é˜»æ­¢ | æ­¤ç½‘ç»œçš„ä¸“ç”¨ä»£ç†å·²å…³é—­ |
| è¯·é‡æ–°å¯åŠ¨è®¾å¤‡ï¼Œåœ¨`âœˆï¸é£è¡Œæ¨¡å¼`æˆ–SIMå¡é”å®šä¸‹ï¼Œé€šè¿‡`Wi-Fi`æˆ–`æœ‰çº¿ç½‘ç»œ`å†æ¬¡æ‰§è¡Œè§£é”æ­¥éª¤ | å¯ä»¥æ­£å¸¸ä½¿ç”¨ | è¯·æ£€æŸ¥å½“å‰ç½‘ç»œå¯¹QUIC(UDP,443)æµé‡çš„Blockã€QoSæˆ–Dropæƒ…å†µ | è¯·æ£€æŸ¥è‡³`mask.icloud.com`ä¸`mask-h2.icloud.com`çš„è¿æ¥æƒ…å†µ | è¯·åœ¨æ­¤`Wi-Fi`æˆ–`æœ‰çº¿ç½‘ç»œ`çš„è®¾ç½®ä¸­æ‰“å¼€`iCloudä¸“ç”¨ä»£ç†` |
|<p> **æ­¤å›½å®¶æˆ–åœ°åŒºå°šä¸æ”¯æŒä¸“ç”¨ä»£ç†ã€‚** <br> {å›½å®¶æˆ–åœ°åŒº}å°šä¸æ”¯æŒä¸“ç”¨ä»£ç†ã€‚å½“æ‚¨åœ¨æ”¯æŒçš„å›½å®¶æˆ–åœ°åŒºè”ç½‘æ—¶ï¼Œå¯å°†å…¶æ‰“å¼€ã€‚</p>|<p> æ— è¯´æ˜ </p>|<p> **ç”±äºæŠ€æœ¯é—®é¢˜ï¼Œä¸“ç”¨ä»£ç†æš‚æ—¶ä¸å¯ç”¨ã€‚** <br> é—®é¢˜è§£å†³æ—¶å°†è‡ªåŠ¨æ¢å¤å·¥ä½œã€‚ </p>|<p> **ä¸“ç”¨ä»£ç†å·²å¯¹â€œ{å½“å‰ç½‘ç»œ}â€å…³é—­** <br> ä¸“ç”¨ä»£ç†ä¸å—æ­¤ç½‘ç»œæ”¯æŒæˆ–å·²åœ¨Wi-Fiè®¾ç½®ä¸­å…³é—­ã€‚ä¸“ç”¨ä»£ç†å…³é—­æ—¶ï¼Œæ­¤ç½‘ç»œå¯ç›‘æ§æ‚¨çš„äº’è”ç½‘æ´»åŠ¨ï¼Œä¸”æ‚¨çš„IPåœ°å€å°†ä¸ä¼šå¯¹å·²çŸ¥è·Ÿè¸ªå™¨æˆ–ç½‘ç«™éšè—ã€‚</p>|<p> **ä¸“ç”¨ä»£ç†å·²å¯¹â€œ{å½“å‰ç½‘ç»œ}â€å…³é—­** <br> ä½¿ç”¨â€œ{å½“å‰ç½‘ç»œ}â€æ—¶ï¼Œç½‘ç«™å’Œè·Ÿè¸ªå™¨å¯è·å–æ‚¨çš„äº’è”ç½‘åœ°å€ã€‚</p>|
|![ğŸ”’ä¸æ”¯æŒæˆªå›¾](../blob/main/ScreenShots/iCloud%20Private%20Relay%20-%20Not%20Supported%20-%20iOS.jpeg?raw=true "iCloud Private Relay - Not Supported - iOS")|![ğŸ”“å¯ç”¨æˆªå›¾](../blob/main/ScreenShots/iCloud%20Private%20Relay%20-%20Avaliable%20-%20iOS.jpeg?raw=true "iCloud Private Relay - Avaliable - iOS")|![ğŸ”’æš‚ä¸å¯ç”¨æˆªå›¾](../blob/main/ScreenShots/iCloud%20Private%20Relay%20-%20Temporarily%20Unavaliable%20-%20iOS.jpeg?raw=true "iCloud Private Relay - Temporarily Unavaliable - iOS")|![ğŸ”’æµé‡å®¡æ ¸æˆªå›¾](../blob/main/ScreenShots/iCloud%20Private%20Relay%20-%20Network%20Traffic%20Audits%20-%20iOS.jpeg?raw=true "iCloud Private Relay - Network Traffic Audits - iOS")|![ğŸ”’å…³é—­æˆªå›¾](../blob/main/ScreenShots/iCloud%20Private%20Relay%20-%20Turned%20Off%20-%20iOS.jpeg?raw=true "iCloud Private Relay - Turned Off - iOS")|

## åŠŸèƒ½åˆ—è¡¨
  * åœ¨ä»¥ä¸‹ä½ç½®åŠåŠŸèƒ½ä¸­å¯ç”¨: 
    - [x] é‚®ä»¶(Mail)
    - [x] Safariæµè§ˆå™¨(Safari)
      - [x] WebKit(WebKit Networking)
    - [x] DNSæŸ¥è¯¢(DNS resolution queries)
      - [x] https://doh.dns.apple.com/dns-query
      - [x] https://mask.icloud.com/dns-query
      - [x] https://oblivious.r15.doh.dns.akasecure.net/dns-query
      - [x] https://odoh.cloudflare-dns.com/dns-query
    - [x] ä¸å®‰å…¨çš„ http app æµé‡(insecure http app traffic)

## å®‰è£…é“¾æ¥
### ğŸ†•V3ç‰ˆ
#### Surge for macOS
  * Surge:
  * ä¸å«è§„åˆ™é›†çš„æ¨¡å—: [iCloud.PrivateRelay.sgmodule](../raw/main/sgmodule/iCloud.PrivateRelay.sgmodule "ï£¿ iRingo: â˜ï¸ iCloud Private Relay")
    * åŸŸåé›†: [iCloud.PrivateRelay.list](../raw/main/RuleSet/iCloud.PrivateRelay.list "â˜ï¸ iCloud Private Relay")
  * é¢„ç½®ç­–ç•¥ç»„çš„æ¨¡å—:
    * ç­–ç•¥ç»„ä¸º`DIRECT`çš„æ¨¡å—:[iCloud.PrivateRelay.DIRECT.sgmodule](../raw/main/sgmodule/iCloud.PrivateRelay.DIRECT.sgmodule "ï£¿ iRingo: â˜ï¸ iCloud Private Relay")
#### Clash
  * Clash:
    * è§„åˆ™ç»„: [iCloud.PrivateRelay.yaml](../raw/main/RuleSet/iCloud.PrivateRelay.yaml "â˜ï¸ iCloud Private Relay")

### V2ç‰ˆ
#### Surge for macOS
  * Surge:
  * ä¸å«è§„åˆ™é›†çš„æ¨¡å—:[Private_Relay.sgmodule](../blob/main/sgmodule/Private_Relay.sgmodule?raw=true "ï£¿ iRingo for iCloud Private Relay")
    * åŸŸåé›†:
      * QUICä»£ç†æµé‡(å¯ç›´è¿):[Private_Relay.QUIC.list](../blob/main/RuleSet/Private_Relay.QUIC.list?raw=true "iCloud Private Relay QUIC")
      * æ£€æµ‹ä¸é…ç½®æµé‡(éœ€ä»£ç†):[Private_Relay.Configs.list](../blob/main/RuleSet/Private_Relay.Configs.list?raw=true "iCloud Private Relay Configs")
  * é¢„ç½®ç­–ç•¥ç»„çš„æ¨¡å—:
    * ç­–ç•¥ç»„ä¸º`PROXY`çš„æ¨¡å—:[Private_Relay.Uppercase_PROXY.sgmodule](../blob/main/sgmodule/Private_Relay.Uppercase_PROXY.sgmodule?raw=true "ï£¿ iRingo for iCloud Private Relay")
    * ç­–ç•¥ç»„ä¸º`Proxy`çš„æ¨¡å—:[Private_Relay.Proxy.sgmodule](../blob/main/sgmodule/Private_Relay.Proxy.sgmodule?raw=true "ï£¿ iRingo for iCloud Private Relay")
    * ç­–ç•¥ç»„ä¸º`ğŸŒ‘Proxy`çš„æ¨¡å—(å¦‚:DivineEngine):[Private_Relay.DivineEngine.sgmodule](../blob/main/sgmodule/Private_Relay.DivineEngine.sgmodule?raw=true "ï£¿ iRingo for iCloud Private Relay")
#### Clash
  * Clash:
    * è§„åˆ™ç»„:
      * QUICä»£ç†æµé‡(å¯ç›´è¿):[Private_Relay.QUIC.yaml](../blob/main/RuleSet/Private_Relay.QUIC.yaml?raw=true "iCloud Private Relay QUIC")
      * æ£€æµ‹ä¸é…ç½®æµé‡(éœ€ä»£ç†):[Private_Relay.Configs.yaml](../blob/main/RuleSet/Private_Relay.Configs.yaml?raw=true "iCloud Private Relay Configs")

### V1ç‰ˆ
#### Surge for macOS
  * Surge:
  * ä¸å«è§„åˆ™é›†çš„æ¨¡å—:[iCloud_Private_Relay_Gateway.sgmodule](../blob/main/Archive/sgmodule/iCloud_Private_Relay_Gateway.sgmodule?raw=true "ï£¿ Enable iCloud Private Relay on gateway")
    * åŸŸåé›†:
      * QUICä»£ç†æµé‡:[iCloud_Private_Relay_QUIC.list](../blob/main/Archive/RuleSet/iCloud_Private_Relay_QUIC.list?raw=true "iCloud Private Relay QUIC")
      * æ£€æµ‹ä¸é…ç½®æµé‡:[iCloud_Private_Relay_Configs.list](../blob/main/Archive/RuleSet/iCloud_Private_Relay_Configs.list?raw=true "iCloud Private Relay Configs")
  * é¢„ç½®ç­–ç•¥ç»„çš„æ¨¡å—:
    * é’ˆå¯¹ç­–ç•¥ç»„ä¸º`PROXY`çš„æ¨¡å—:[iCloud_Private_Relay_Gateway_for_Uppercase_PROXY.sgmodule](../blob/main/Archive/sgmodule/iCloud_Private_Relay_Gateway_for_Uppercase_PROXY.sgmodule?raw=true "ï£¿ Enable iCloud Private Relay on gateway")
    * é’ˆå¯¹ç­–ç•¥ç»„ä¸º`Proxy`çš„æ¨¡å—:[iCloud_Private_Relay_Gateway_for_Proxy.sgmodule](../blob/main/Archive/sgmodule/iCloud_Private_Relay_Gateway_for_Proxy.sgmodule?raw=true "ï£¿ Enable iCloud Private Relay on gateway")
    * é’ˆå¯¹ç­–ç•¥ç»„ä¸º`ğŸŒ‘Proxy`çš„æ¨¡å—(å¦‚:DivineEngine):[iCloud_Private_Relay_Gateway_for_DivineEngine.sgmodule](../blob/main/Archive/sgmodule/iCloud_Private_Relay_Gateway_for_DivineEngine.sgmodule?raw=true "ï£¿ Enable iCloud Private Relay on gateway")
    * é’ˆå¯¹ç­–ç•¥ç»„ä¸º`Apple`çš„æ¨¡å—:[iCloud_Private_Relay_Gateway_for_Apple.sgmodule](../blob/main/Archive/sgmodule/iCloud_Private_Relay_Gateway_for_Apple.sgmodule?raw=true "ï£¿ Enable iCloud Private Relay on gateway")
    * é’ˆå¯¹ç­–ç•¥ç»„ä¸º`ğŸApple`çš„æ¨¡å—:[iCloud_Private_Relay_Gateway_for_Apple_icon.sgmodule](../blob/main/Archive/sgmodule/iCloud_Private_Relay_Gateway_for_Apple_icon.sgmodule?raw=true "ï£¿ Enable iCloud Private Relay on gateway")
    * é’ˆå¯¹ç­–ç•¥ç»„ä¸º`ğŸ Apple`çš„æ¨¡å—(å¦‚:Surgio):[iCloud_Private_Relay_Gateway_for_Surgio.sgmodule](../blob/main/Archive/sgmodule/iCloud_Private_Relay_Gateway_for_Surgio.sgmodule?raw=true "ï£¿ Enable iCloud Private Relay on gateway")
    * é’ˆå¯¹ç­–ç•¥ç»„ä¸º`ğŸ è‹¹æœæœåŠ¡`çš„æ¨¡å—(å¦‚:ACL4SSR):[iCloud_Private_Relay_Gateway_for_ACL4SSR.sgmodule](../blob/main/Archive/sgmodule/iCloud_Private_Relay_Gateway_for_ACL4SSR.sgmodule?raw=true "ï£¿ Enable iCloud Private Relay on gateway")
#### Clash
  * Clash:
    * è§„åˆ™ç»„:[iCloud_Private_Relay.yaml](../blob/main/Archive/RuleSet/iCloud_Private_Relay.yaml?raw=true "iCloud Private Relay")
